<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Web Lifecycle 1</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <meta content="ED" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2016/W3C-ED" rel="stylesheet" type="text/css">
  <meta content="Bikeshed version d4e7d28ddfef2aa3bc0602e7461b029e8ecc025a" name="generator">
  <meta content="d4e7d28ddfef2aa3bc0602e7461b029e8ecc025a" name="document-revision">
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: gray;
    color: white;
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: black;
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: #005a9c;
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-dfn-panel */

        .dfn-panel {
            position: absolute;
            z-index: 35;
            height: auto;
            width: -webkit-fit-content;
            width: fit-content;
            max-width: 300px;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: #DDDDDD;
            color: black;
            border: outset 0.2em;
        }
        .dfn-panel:not(.on) { display: none; }
        .dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
        .dfn-panel > b { display: block; }
        .dfn-panel a { color: black; }
        .dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
        .dfn-panel > b + b { margin-top: 0.25em; }
        .dfn-panel ul { padding: 0; }
        .dfn-panel li { list-style: inside; }
        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: .5em;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
        }

        .dfn-paneled { cursor: pointer; }
        </style>
<style>/* style-syntax-highlighting */
pre.idl.highlight { color: #708090; }
.highlight:not(.idl) { background: hsl(24, 20%, 95%); }
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }
.highlight .c { color: #708090 } /* Comment */
.highlight .k { color: #990055 } /* Keyword */
.highlight .l { color: #000000 } /* Literal */
.highlight .n { color: #0077aa } /* Name */
.highlight .o { color: #999999 } /* Operator */
.highlight .p { color: #999999 } /* Punctuation */
.highlight .cm { color: #708090 } /* Comment.Multiline */
.highlight .cp { color: #708090 } /* Comment.Preproc */
.highlight .c1 { color: #708090 } /* Comment.Single */
.highlight .cs { color: #708090 } /* Comment.Special */
.highlight .kc { color: #990055 } /* Keyword.Constant */
.highlight .kd { color: #990055 } /* Keyword.Declaration */
.highlight .kn { color: #990055 } /* Keyword.Namespace */
.highlight .kp { color: #990055 } /* Keyword.Pseudo */
.highlight .kr { color: #990055 } /* Keyword.Reserved */
.highlight .kt { color: #990055 } /* Keyword.Type */
.highlight .ld { color: #000000 } /* Literal.Date */
.highlight .m { color: #000000 } /* Literal.Number */
.highlight .s { color: #a67f59 } /* Literal.String */
.highlight .na { color: #0077aa } /* Name.Attribute */
.highlight .nc { color: #0077aa } /* Name.Class */
.highlight .no { color: #0077aa } /* Name.Constant */
.highlight .nd { color: #0077aa } /* Name.Decorator */
.highlight .ni { color: #0077aa } /* Name.Entity */
.highlight .ne { color: #0077aa } /* Name.Exception */
.highlight .nf { color: #0077aa } /* Name.Function */
.highlight .nl { color: #0077aa } /* Name.Label */
.highlight .nn { color: #0077aa } /* Name.Namespace */
.highlight .py { color: #0077aa } /* Name.Property */
.highlight .nt { color: #669900 } /* Name.Tag */
.highlight .nv { color: #222222 } /* Name.Variable */
.highlight .ow { color: #999999 } /* Operator.Word */
.highlight .mb { color: #000000 } /* Literal.Number.Bin */
.highlight .mf { color: #000000 } /* Literal.Number.Float */
.highlight .mh { color: #000000 } /* Literal.Number.Hex */
.highlight .mi { color: #000000 } /* Literal.Number.Integer */
.highlight .mo { color: #000000 } /* Literal.Number.Oct */
.highlight .sb { color: #a67f59 } /* Literal.String.Backtick */
.highlight .sc { color: #a67f59 } /* Literal.String.Char */
.highlight .sd { color: #a67f59 } /* Literal.String.Doc */
.highlight .s2 { color: #a67f59 } /* Literal.String.Double */
.highlight .se { color: #a67f59 } /* Literal.String.Escape */
.highlight .sh { color: #a67f59 } /* Literal.String.Heredoc */
.highlight .si { color: #a67f59 } /* Literal.String.Interpol */
.highlight .sx { color: #a67f59 } /* Literal.String.Other */
.highlight .sr { color: #a67f59 } /* Literal.String.Regex */
.highlight .s1 { color: #a67f59 } /* Literal.String.Single */
.highlight .ss { color: #a67f59 } /* Literal.String.Symbol */
.highlight .vc { color: #0077aa } /* Name.Variable.Class */
.highlight .vg { color: #0077aa } /* Name.Variable.Global */
.highlight .vi { color: #0077aa } /* Name.Variable.Instance */
.highlight .il { color: #000000 } /* Literal.Number.Integer.Long */
</style>
 <body class="h-entry">
  <div class="head">
   <header>
    <p data-fill-with="logo"><a href="https://www.w3.org/"><img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" width="72"></a> </p>
    <h1 class="p-name no-ref" id="title">Web Lifecycle 1</h1>
    <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Editor’s Draft, <time class="dt-updated" datetime="2018-04-27">27 April 2018</time></span></h2>
   </header>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/wicg/web-lifecycle/issues/">GitHub</a>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:panicker@google.com">Shubhie Panicker</a> (<a class="p-org org" href="https://google.com">Google</a>)
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:domenic@chromium.org">Domenic Denicola</a> (<a class="p-org org" href="https://google.com">Google</a>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2018 <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This document defines an API that supports browsers' ability to manage lifecycle of web pages.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> <em>This section describes the status of this document at the time of its publication. Other documents may supersede this document. A list of current <abbr title="World Wide Web Consortium">W3C</abbr> publications and the latest revision of this technical report can be found in the <a href="https://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical reports index</a> at https://www.w3.org/TR/.</em> </p>
   <p> This document was published by the <a href="https://www.w3.org/webperf/">Web Performance Working Group</a> as an Editors Draft. This document is intended to become a W3C Recommendation. </p>
   <p></p>
   <p> Feedback and comments on this specification are welcome, please send them to <a href="mailto:public-web-perf@w3.org?subject=%5Bweb-lifecycle%5D">public-web-perf@w3.org</a> (<a href="mailto:public-web-perf-request@w3.org?subject=subscribe">subscribe</a>, <a href="https://lists.w3.org/Archives/Public/public-web-perf/">archives</a>) with <code class="highlight"><span class="o">%</span><span class="mi">5</span>Bweb<span class="o">-</span>lifecycle<span class="o">%</span><span class="mi">5</span>D</code> at the start of your email’s subject. </p>
   <p> Publication as an Editors Draft does not imply endorsement by the <abbr title="World Wide Web Consortium">W3C</abbr> Membership. This is a draft document and may
    be updated, replaced or obsoleted by other documents at any time. It is inappropriate to cite
    this document as other than work in progress. </p>
   <p> This document was produced by a group operating under the <a href="https://www.w3.org/Consortium/Patent-Policy/"><abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>. <abbr title="World Wide Web Consortium">W3C</abbr> maintains a <a href="https://www.w3.org/2004/01/pp-impl/45211/status" rel="disclosure">public list of any patent disclosures</a> made in connection with the deliverables of the group; that page also includes instructions for disclosing a patent. An individual who has actual knowledge of a patent which the individual believes contains <a href="https://www.w3.org/Consortium/Patent-Policy/#def-essential">Essential Claim(s)</a> must disclose the information in accordance with <a href="https://www.w3.org/Consortium/Patent-Policy/#sec-Disclosure">section 6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>. </p>
   <p>This document is governed by the <a href="https://www.w3.org/2018/Process-20180201/" id="w3c_process_revision">1 February 2018 W3C Process Document</a>. </p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#sec-lifecycle-states"><span class="secno">2</span> <span class="content">Lifecycle States</span></a>
    <li>
     <a href="#sec-api"><span class="secno">3</span> <span class="content">API</span></a>
     <ol class="toc">
      <li><a href="#example"><span class="secno">3.1</span> <span class="content">Usage example</span></a>
     </ol>
    <li>
     <a href="#sec-processing-model"><span class="secno">4</span> <span class="content">Processing model</span></a>
     <ol class="toc">
      <li>
       <a href="#mod"><span class="secno">4.1</span> <span class="content">Modifications to HTML specifications</span></a>
       <ol class="toc">
        <li><a href="#html-task-dfn"><span class="secno">4.1.1</span> <span class="content">HTML: <span>task definition</span></span></a>
        <li><a href="#html-task-source-dfn"><span class="secno">4.1.2</span> <span class="content">HTML: <span>task source</span></span></a>
        <li><a href="#html-bfcache-dfn"><span class="secno">4.1.3</span> <span class="content">HTML: <span>Unloading documents</span> and <span>History Traversal</span></span></a>
        <li><a href="#html-html-event-loop-processing-model"><span class="secno">4.1.4</span> <span class="content">HTML: <span>HTML Event Loop Processing Model</span></span></a>
        <li><a href="#html-discarding-browsing-context"><span class="secno">4.1.5</span> <span class="content">HTML: <span>Discarding browsing context</span></span></a>
        <li><a href="#html-modifications-to-navigate-a-browsing-context"><span class="secno">4.1.6</span> <span class="content">HTML: Modifications to <span>Navigate a browsing context</span></span></a>
       </ol>
      <li>
       <a href="#additions-to-web-lifecycle-spec"><span class="secno">4.2</span> <span class="content">Additions to Web Lifecycle spec</span></a>
       <ol class="toc">
        <li><a href="#frozenness-state"><span class="secno">4.2.1</span> <span class="content">FROZENNESS state</span></a>
        <li>
         <a href="#reacting-to-frozenness-state-changes"><span class="secno">4.2.2</span> <span class="content">Reacting to FROZENNESS state changes</span></a>
         <ol class="toc">
          <li><a href="#change-frozenness-of-a-top-level-document"><span class="secno">4.2.2.1</span> <span class="content">Change frozenness of a top-level document</span></a>
          <li><a href="#change-frozenness-of-document"><span class="secno">4.2.2.2</span> <span class="content">Change frozenness of document</span></a>
         </ol>
        <li><a href="#discarded-state"><span class="secno">4.2.3</span> <span class="content">DISCARDED state</span></a>
       </ol>
     </ol>
    <li><a href="#acknowledgements"><span class="secno">5</span> <span class="content">Acknowledgements</span></a>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
    With large numbers of web apps (and tabs) running, critical resources such as memory, CPU, battery, network etc easily get oversubscribed, leading to a bad end user experience. Application lifecycle is a key way that modern OSs manage resources. 
   <p>For a platform to support application lifecycle, it needs to:</p>
   <ul>
    <li data-md="">
     <p>provide developers with signals about transitions between the lifecycle states</p>
    <li data-md="">
     <p>provide lifecycle-compatible APIs that allow key capabilities to work even when the app is backgrounded or stopped.</p>
   </ul>
   <p>This proposal attempts to define what the lifecycle of a web page is and add needed extensions to enable web applications to respond to two important lifecycle events commonly performed by user agents:</p>
   <ul>
    <li data-md="">
     <p>Tab discarding (for memory saving)</p>
    <li data-md="">
     <p>CPU suspension (for battery, data, CPU saving)</p>
   </ul>
   <h2 class="heading settled" data-level="2" id="sec-lifecycle-states"><span class="secno">2. </span><span class="content">Lifecycle States</span><a class="self-link" href="#sec-lifecycle-states"></a></h2>
   <p>This spec defines what the lifecycle of a web page is and adds extensions to enable web applications to respond to two important lifecycle events commonly performed by user agents:</p>
   <ul>
    <li data-md="">
     <p>CPU suspension (for conserving battery, data, CPU)</p>
    <li data-md="">
     <p>Tab discarding (for memory saving)</p>
   </ul>
   <p>This spec formalizes two new lifecycle states to support the above:</p>
   <ul>
    <li data-md="">
     <p>FROZEN: lifecycle state for CPU suspension. Normally HIDDEN pages will be FROZEN to conserve resources.</p>
    <li data-md="">
     <p>DISCARDED: lifecycle state for tab discarding. Normally FROZEN frames will be moved to DISCARDED to conserve resources.</p>
   </ul>
   <p>TODO(panicker): Insert diagram</p>
   <h2 class="heading settled" data-level="3" id="sec-api"><span class="secno">3. </span><span class="content">API</span><a class="self-link" href="#sec-api"></a></h2>
   <p>Web Lifecycle involves the following additions:</p>
<pre class="idl highlight def"><span class="kt">partial</span> <span class="kt">interface</span> <a class="nv idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/dom.html#document" id="ref-for-document">Document</a> {
    <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler">EventHandler</a>  <dfn class="nv idl-code" data-dfn-for="Document" data-dfn-type="attribute" data-export="" data-type="EventHandler" id="dom-document-onfreeze"><code class="highlight">onfreeze</code><a class="self-link" href="#dom-document-onfreeze"></a></dfn>;
    <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler①">EventHandler</a>  <dfn class="nv idl-code" data-dfn-for="Document" data-dfn-type="attribute" data-export="" data-type="EventHandler" id="dom-document-onresume"><code class="highlight">onresume</code><a class="self-link" href="#dom-document-onresume"></a></dfn>;
    <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean"><span class="kt">boolean</span></a> <dfn class="nv idl-code" data-dfn-for="Document" data-dfn-type="attribute" data-export="" data-readonly="" data-type="boolean" id="dom-document-wasdiscarded"><code class="highlight">wasDiscarded</code><a class="self-link" href="#dom-document-wasdiscarded"></a></dfn>;
};
</pre>
   <p class="note" role="note"><span>NOTE:</span> these are added on Document, instead of on Window, for consistency with the <a href="https://w3c.github.io/page-visibility/">page visibility API</a>; we expect these APIs to be used in tandem with that existing one.</p>
   <p class="note" role="note"><span>NOTE:</span> In addition <a href="https://github.com/whatwg/html/issues/3378">clientId and discardedClientId</a> will be added to Window, to support restoring view state when user revisits a discarded page, causing a reload. We expect those to be used by code that reacts to these events.</p>
   <h3 class="heading settled" data-level="3.1" id="example"><span class="secno">3.1. </span><span class="content">Usage example</span><a class="self-link" href="#example"></a></h3>
   <p>Example of handling freeze and resume:</p>
<pre class="example highlight" id="example-0f21cf48"><a class="self-link" href="#example-0f21cf48"></a>TODO<span class="p">(</span>panicker<span class="p">)</span><span class="o">:</span> Add code sample here<span class="p">.</span>
</pre>
   <p>Example of restoring view state after discard:</p>
<pre class="example highlight" id="example-0f21cf48①"><a class="self-link" href="#example-0f21cf48①"></a>TODO<span class="p">(</span>panicker<span class="p">)</span><span class="o">:</span> Add code sample here<span class="p">.</span>
</pre>
   <p>Example to show how existing onvisibilitychange API works together with new Lifecycle APIs:</p>
<pre class="example highlight" id="example-0f21cf48②"><a class="self-link" href="#example-0f21cf48②"></a>TODO<span class="p">(</span>panicker<span class="p">)</span><span class="o">:</span> Add code sample here<span class="p">.</span>
</pre>
   <h2 class="heading settled" data-level="4" id="sec-processing-model"><span class="secno">4. </span><span class="content">Processing model</span><a class="self-link" href="#sec-processing-model"></a></h2>
   <h3 class="heading settled" data-level="4.1" id="mod"><span class="secno">4.1. </span><span class="content">Modifications to HTML specifications</span><a class="self-link" href="#mod"></a></h3>
   <h4 class="heading settled" data-level="4.1.1" id="html-task-dfn"><span class="secno">4.1.1. </span><span class="content">HTML: <a href="https://html.spec.whatwg.org/#concept-task">task definition</a></span><a class="self-link" href="#html-task-dfn"></a></h4>
   <p>Each task gets an associated <dfn data-dfn-for="task" data-dfn-type="dfn" data-noexport="" id="task-freezeable">freezeable<a class="self-link" href="#task-freezeable"></a></dfn> (bool) field</p>
   <h4 class="heading settled" data-level="4.1.2" id="html-task-source-dfn"><span class="secno">4.1.2. </span><span class="content">HTML: <a href="https://html.spec.whatwg.org/#task-source">task source</a></span><a class="self-link" href="#html-task-source-dfn"></a></h4>
   <p>Each task source is classified as <dfn data-dfn-for="task" data-dfn-type="dfn" data-noexport="" id="task-freezeable①">freezeable<a class="self-link" href="#task-freezeable①"></a></dfn> or <dfn data-dfn-for="task" data-dfn-type="dfn" data-noexport="" id="task-unfreezeable">unfreezeable<a class="self-link" href="#task-unfreezeable"></a></dfn>.</p>
   <p>TODO(panicker): Add specific examples of task sources such as timers, loading.</p>
   <p>TODO(domenic): classify all existing task sources in the HTML spec; find out if other specs have defined any relevant task sources.</p>
   <h4 class="heading settled" data-level="4.1.3" id="html-bfcache-dfn"><span class="secno">4.1.3. </span><span class="content">HTML: <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#unloading-documents">Unloading documents</a> and <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#history-traversal">History Traversal</a></span><a class="self-link" href="#html-bfcache-dfn"></a></h4>
   <p>When documents move into and out of bfcache they will transition through <a data-link-type="dfn" href="#frozen" id="ref-for-frozen">FROZEN</a> &amp; <a data-link-type="dfn" href="#unfrozen" id="ref-for-unfrozen">UNFROZEN</a> state respectively.</p>
   <ul>
    <li data-md="">
     <p>In <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#unload-a-document">unload a document</a> algorithm, before Step #5 if the persisted attribute is true (moving to bfcache) run the <a href="#change-frozenness-of-document" id="ref-for-change-frozenness-of-document">§4.2.2.2 Change frozenness of document</a>, passing in document and <code class="highlight">FROZEN</code>.</p>
    <li data-md="">
     <p>In the <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#history-traversal">History traversal</a> algorithm, after Step #4.6.4 if the persisted attribute is true (moving out of bfcache) run the <a href="#change-frozenness-of-document" id="ref-for-change-frozenness-of-document①">§4.2.2.2 Change frozenness of document</a>, passing in document and <code class="highlight">UNFROZEN</code>.</p>
   </ul>
   <h4 class="heading settled" data-level="4.1.4" id="html-html-event-loop-processing-model"><span class="secno">4.1.4. </span><span class="content">HTML: <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop-processing-model">HTML Event Loop Processing Model</a></span><a class="self-link" href="#html-html-event-loop-processing-model"></a></h4>
   <p>Add to beginning of Step #8.1.4.2.1:</p>
   <p>In the case of a a browsing context event loop if the Document of the task is in <a data-link-type="dfn" href="#frozen" id="ref-for-frozen①">FROZEN</a> state, then ignore freezeable tasks associated with such a Document.</p>
   <h4 class="heading settled" data-level="4.1.5" id="html-discarding-browsing-context"><span class="secno">4.1.5. </span><span class="content">HTML: <a href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded">Discarding browsing context</a></span><a class="self-link" href="#html-discarding-browsing-context"></a></h4>
   <p>Rename <a href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded">”Discarded” in HTML spec</a> to "Destroyed".</p>
   <h4 class="heading settled" data-level="4.1.6" id="html-modifications-to-navigate-a-browsing-context"><span class="secno">4.1.6. </span><span class="content">HTML: Modifications to <a href="https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate">Navigate a browsing context</a></span><a class="self-link" href="#html-modifications-to-navigate-a-browsing-context"></a></h4>
    Before Step#1 add following: 
   <p>If the browsing context was previously <a data-link-type="dfn" href="#discarded" id="ref-for-discarded">DISCARDED</a> then <code class="highlight">wasDiscarded</code> must be set to true on its active document and on all documents of its nested browsing contexts.</p>
   <h3 class="heading settled" data-level="4.2" id="additions-to-web-lifecycle-spec"><span class="secno">4.2. </span><span class="content">Additions to Web Lifecycle spec</span><a class="self-link" href="#additions-to-web-lifecycle-spec"></a></h3>
   <h4 class="heading settled" data-dfn-type="dfn" data-level="4.2.1" data-lt="FROZENNESS state" data-noexport="" id="frozenness-state"><span class="secno">4.2.1. </span><span class="content">FROZENNESS state</span><a class="self-link" href="#frozenness-state"></a></h4>
    A document can be in one of the following FROZENNESS states: 
   <ul>
    <li data-md="">
     <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-export="" id="frozen">FROZEN</dfn>: the document is frozen, any freezeable tasks associated with the document will not run</p>
    <li data-md="">
     <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-export="" id="unfrozen">UNFROZEN</dfn>: the document is not frozen, tasks associated with the document will run as usual</p>
     <p class="note" role="note"><span>NOTE:</span> Per the <a href="#change-frozenness-of-a-top-level-document" id="ref-for-change-frozenness-of-a-top-level-document">§4.2.2.1 Change frozenness of a top-level document</a> algorithm, when the Document of the top level browsing context changes its FROZENNESS state then all documents of descendant browsing contexts will also change FROZENNESS to the same value (and be consistent with the Document of the top level browsing context).</p>
   </ul>
   <p>The UA may choose to execute <a href="#change-frozenness-of-a-top-level-document" id="ref-for-change-frozenness-of-a-top-level-document①">§4.2.2.1 Change frozenness of a top-level document</a> with <code class="highlight">FROZEN</code> in certain situations.
For instance, if a browsing context is in the background or hidden, and a grace period has elapsed the UA could execute <a href="#change-frozenness-of-a-top-level-document" id="ref-for-change-frozenness-of-a-top-level-document②">§4.2.2.1 Change frozenness of a top-level document</a> with <code class="highlight">FROZEN</code> to conserve resources and maintain the quality of the (foreground) user experience. 
Specific examples:</p>
   <ul>
    <li data-md="">
     <p>In mobile Chrome, tabs that have been in background for (at least) 5 minutes, may be <a data-link-type="dfn" href="#frozen" id="ref-for-frozen②">FROZEN</a>, to conserve battery and data.</p>
    <li data-md="">
     <p>In desktop Chrome, background tabs that are not important to the user (not used in some time) may be <a data-link-type="dfn" href="#discarded" id="ref-for-discarded①">DISCARDED</a>, to conserve memory</p>
     <p class="note" role="note"><span>NOTE:</span> background tabs that are actively doing work on behalf of the user (eg. playing audio) are generally not <a data-link-type="dfn" href="#frozen" id="ref-for-frozen③">FROZEN</a> or <a data-link-type="dfn" href="#discarded" id="ref-for-discarded②">DISCARDED</a>.</p>
   </ul>
   <p>The UA will typically execute <a href="#change-frozenness-of-a-top-level-document" id="ref-for-change-frozenness-of-a-top-level-document③">§4.2.2.1 Change frozenness of a top-level document</a> with <code class="highlight">UNFROZEN</code> when the user revisits that browsing context. In addition, the UA may choose to periodically execute <a href="#change-frozenness-of-a-top-level-document" id="ref-for-change-frozenness-of-a-top-level-document④">§4.2.2.1 Change frozenness of a top-level document</a> with <code class="highlight">UNFROZEN</code> in the background, if plentiful resources are available.</p>
   <h4 class="heading settled" data-dfn-type="dfn" data-level="4.2.2" data-lt="Reacting to FROZENNESS state changes" data-noexport="" id="reacting-to-frozenness-state-changes"><span class="secno">4.2.2. </span><span class="content">Reacting to FROZENNESS state changes</span><a class="self-link" href="#reacting-to-frozenness-state-changes"></a></h4>
   <h5 class="heading settled dfn-paneled" data-dfn-type="dfn" data-level="4.2.2.1" data-lt="Change frozenness of a top-level document" data-noexport="" id="change-frozenness-of-a-top-level-document"><span class="secno">4.2.2.1. </span><span class="content">Change frozenness of a top-level document</span></h5>
    To change the frozenness of a top-level document passing in a document <var>doc</var> and FROZENNESS state <var>x</var> (one of <code class="highlight">frozen</code>, <code class="highlight">unfrozen</code>): 
   <ul>
    <li data-md="">
     <p class="assertion">Assert: <var>doc</var>’s browsing context is a top-level browsing context.</p>
    <li data-md="">
     <p>Execute <a href="#change-frozenness-of-document" id="ref-for-change-frozenness-of-document②">§4.2.2.2 Change frozenness of document</a> passing in <var>doc</var> and <var>x</var>.</p>
    <li data-md="">
     <p>Let descendants be the <a href="https://html.spec.whatwg.org/#list-of-the-descendant-browsing-contexts">list of the descendant browsing contexts of document</a>.</p>
    <li data-md="">
     <p>For each browsing context <var>b</var> in descendants:</p>
     <ul>
      <li data-md="">
       <p>Let <var>d</var> be the active document of <var>b</var>.</p>
      <li data-md="">
       <p>Execute <a href="#change-frozenness-of-document" id="ref-for-change-frozenness-of-document③">§4.2.2.2 Change frozenness of document</a> passing arguments <var>d</var> and <var>x</var>.</p>
     </ul>
   </ul>
   <h5 class="heading settled dfn-paneled" data-dfn-type="dfn" data-level="4.2.2.2" data-lt="Change frozenness of document" data-noexport="" id="change-frozenness-of-document"><span class="secno">4.2.2.2. </span><span class="content">Change frozenness of document</span></h5>
    To change the frozenness of a document given a document <var>doc</var> and FROZENNESS state <var>x</var>: 
   <ul>
    <li data-md="">
     <p>If <var>x</var> is <code class="highlight">FROZEN</code>:</p>
     <ul>
      <li data-md="">
       <p>Set <var>doc</var>’s FROZENNESS state to <code class="highlight">FROZEN</code>.</p>
      <li data-md="">
       <p>Fire an event named freeze at <var>doc</var>.</p>
     </ul>
    <li data-md="">
     <p>Otherwise:</p>
     <ul>
      <li data-md="">
       <p>Fire an event named resume at <var>doc</var>.</p>
      <li data-md="">
       <p>Set <var>doc</var>’s FROZENNESS state to <code class="highlight">UNFROZEN</code>.</p>
     </ul>
     <p class="note" role="note"><span>NOTE:</span> it is intentional that the ordering between event-firing and setting the state are different in the two cases above.</p>
   </ul>
   <h4 class="heading settled" data-dfn-type="dfn" data-level="4.2.3" data-lt="DISCARDED state" data-noexport="" id="discarded-state"><span class="secno">4.2.3. </span><span class="content">DISCARDED state</span><a class="self-link" href="#discarded-state"></a></h4>
    <dfn class="dfn-paneled" data-dfn-type="dfn" data-export="" id="discarded">DISCARDED</dfn> is a system intervention where UA chooses to <a href="https://html.spec.whatwg.org/multipage/window-object.html#a-browsing-context-is-discarded">destroy the browsing context</a>, and consequently all the Document objects for all the entries in the browsing context’s session history are destroyed as well. This is typically done to reclaim system memory, when memory (and other resources) are running low. 
   <p>Browsing contexts -- that are in the background and have their documents in <a href="https://www.w3.org/TR/page-visibility-2/#visibility-states-and-the-visibilitystate-enum">VisibilityState hidden</a> -- can be <a data-link-type="dfn" href="#discarded" id="ref-for-discarded③">DISCARDED</a>, under resource pressure (eg. low memory).</p>
   <p>When a top level browsing context (tab in the browser) is <a data-link-type="dfn" href="#discarded" id="ref-for-discarded④">DISCARDED</a> due to resource pressure (or unexpected events eg. process crash), and say later the user revisits the tab in the browser, then the Document of the new top level browsing context and documents of all its descendant browsing contexts will have <code class="highlight">wasDiscarded</code> state set to true.</p>
   <h2 class="heading settled" data-level="5" id="acknowledgements"><span class="secno">5. </span><span class="content">Acknowledgements</span><a class="self-link" href="#acknowledgements"></a></h2>
   <p>Special thanks to Ojan Vafai, Philip Walton, Olli Petay, Todd Reifsteck for their technical input and suggestions that led to improvements to this specification.</p>
  </main>
<script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#change-frozenness-of-a-top-level-document">Change frozenness of a top-level document</a><span>, in §4.2.2</span>
   <li><a href="#change-frozenness-of-document">Change frozenness of document</a><span>, in §4.2.2.1</span>
   <li><a href="#discarded">DISCARDED</a><span>, in §4.2.3</span>
   <li><a href="#discarded-state">DISCARDED state</a><span>, in §4.2.2.2</span>
   <li>
    freezeable
    <ul>
     <li><a href="#task-freezeable">dfn for task</a><span>, in §4.1.1</span>
     <li><a href="#task-freezeable①">dfn for task</a><span>, in §4.1.2</span>
    </ul>
   <li><a href="#frozen">FROZEN</a><span>, in §4.2.1</span>
   <li><a href="#frozenness-state">FROZENNESS state</a><span>, in §4.2</span>
   <li><a href="#dom-document-onfreeze">onfreeze</a><span>, in §3</span>
   <li><a href="#dom-document-onresume">onresume</a><span>, in §3</span>
   <li><a href="#reacting-to-frozenness-state-changes">Reacting to FROZENNESS state changes</a><span>, in §4.2.1</span>
   <li><a href="#task-unfreezeable">unfreezeable</a><span>, in §4.1.2</span>
   <li><a href="#unfrozen">UNFROZEN</a><span>, in §4.2.1</span>
   <li><a href="#dom-document-wasdiscarded">wasDiscarded</a><span>, in §3</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><a href="https://html.spec.whatwg.org/multipage/dom.html#document">Document</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">EventHandler</a>
    </ul>
   <li>
    <a data-link-type="biblio">[WebIDL]</a> defines the following terms:
    <ul>
     <li><a href="https://heycam.github.io/webidl/#idl-boolean">boolean</a>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-webidl">[WebIDL]
   <dd>Cameron McCormack; Boris Zbarsky; Tobie Langel. <a href="https://heycam.github.io/webidl/">Web IDL</a>. 15 December 2016. ED. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><span class="kt">partial</span> <span class="kt">interface</span> <a class="nv idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/dom.html#document" id="ref-for-document①">Document</a> {
    <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler②">EventHandler</a>  <a class="nv" data-type="EventHandler" href="#dom-document-onfreeze"><code class="highlight">onfreeze</code></a>;
    <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler①①">EventHandler</a>  <a class="nv" data-type="EventHandler" href="#dom-document-onresume"><code class="highlight">onresume</code></a>;
    <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean①"><span class="kt">boolean</span></a> <a class="nv" data-readonly="" data-type="boolean" href="#dom-document-wasdiscarded"><code class="highlight">wasDiscarded</code></a>;
};

</pre>
  <aside class="dfn-panel" data-for="frozen">
   <b><a href="#frozen">#frozen</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-frozen">4.1.3. HTML: Unloading documents and History Traversal</a>
    <li><a href="#ref-for-frozen①">4.1.4. HTML: HTML Event Loop Processing Model</a>
    <li><a href="#ref-for-frozen②">4.2.1. FROZENNESS state</a> <a href="#ref-for-frozen③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="unfrozen">
   <b><a href="#unfrozen">#unfrozen</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-unfrozen">4.1.3. HTML: Unloading documents and History Traversal</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="change-frozenness-of-a-top-level-document">
   <b><a href="#change-frozenness-of-a-top-level-document">#change-frozenness-of-a-top-level-document</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-change-frozenness-of-a-top-level-document">4.2.1. FROZENNESS state</a> <a href="#ref-for-change-frozenness-of-a-top-level-document">(2)</a> <a href="#ref-for-change-frozenness-of-a-top-level-document">(3)</a> <a href="#ref-for-change-frozenness-of-a-top-level-document">(4)</a> <a href="#ref-for-change-frozenness-of-a-top-level-document">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="change-frozenness-of-document">
   <b><a href="#change-frozenness-of-document">#change-frozenness-of-document</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-change-frozenness-of-document">4.1.3. HTML: Unloading documents and History Traversal</a> <a href="#ref-for-change-frozenness-of-document">(2)</a>
    <li><a href="#ref-for-change-frozenness-of-document">4.2.2.1. Change frozenness of a top-level document</a> <a href="#ref-for-change-frozenness-of-document">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="discarded">
   <b><a href="#discarded">#discarded</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-discarded">4.1.6. HTML: Modifications to Navigate a browsing context</a>
    <li><a href="#ref-for-discarded①">4.2.1. FROZENNESS state</a> <a href="#ref-for-discarded②">(2)</a>
    <li><a href="#ref-for-discarded③">4.2.3. DISCARDED state</a> <a href="#ref-for-discarded④">(2)</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

        document.body.addEventListener("click", function(e) {
            var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
            // Find the dfn element or panel, if any, that was clicked on.
            var el = e.target;
            var target;
            var hitALink = false;
            while(el.parentElement) {
                if(el.tagName == "A") {
                    // Clicking on a link in a <dfn> shouldn't summon the panel
                    hitALink = true;
                }
                if(el.classList.contains("dfn-paneled")) {
                    target = "dfn";
                    break;
                }
                if(el.classList.contains("dfn-panel")) {
                    target = "dfn-panel";
                    break;
                }
                el = el.parentElement;
            }
            if(target != "dfn-panel") {
                // Turn off any currently "on" or "activated" panels.
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
                    el.classList.remove("on");
                    el.classList.remove("activated");
                });
            }
            if(target == "dfn" && !hitALink) {
                // open the panel
                var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
                if(dfnPanel) {
                    console.log(dfnPanel);
                    dfnPanel.classList.add("on");
                    var rect = el.getBoundingClientRect();
                    dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
                    dfnPanel.style.top = window.scrollY + rect.top + "px";
                    var panelRect = dfnPanel.getBoundingClientRect();
                    var panelWidth = panelRect.right - panelRect.left;
                    if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                        // Reposition, because the panel is overflowing
                        dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
                    }
                } else {
                    console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
                }
            } else if(target == "dfn-panel") {
                // Switch it to "activated" state, which pins it.
                el.classList.add("activated");
                el.style.left = null;
                el.style.top = null;
            }

        });
        </script>
